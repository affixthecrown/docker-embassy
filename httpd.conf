ServerRoot "/etc/apache2"
Listen 80
<IfModule !mpm_netware_module>
<IfModule !mpm_winnt_module>
User app
Group app
</IfModule>
</IfModule>
ServerAdmin webmaster@embassysys.com
DocumentRoot /var/www/
<Directory />
    Options FollowSymLinks
    AllowOverride None
    Order deny,allow
    Deny from all
</Directory>
<Directory "/var/www/">
    Order allow,deny
    Allow from all
</Directory>

NameVirtualHost *:80

ServerName www.embassysys.com

# Other directives here

</VirtualHost>

<VirtualHost *:80>
DocumentRoot /var/www/
ServerName dapp01.embassysys.com

# Other directives here

</VirtualHost>
<VirtualHost *:80>
DocumentRoot /var/www/
ServerName embassysys.com

# Other directives here

</VirtualHost>

<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>
ErrorLog "logs/error_log"
LogLevel warn
<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    <IfModule logio_module>
      # You need to enable mod_logio.c to use %I and %O
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>
    CustomLog "logs/access_log" common
</IfModule>
DefaultType text/plain
<IfModule mime_module>
    TypesConfig conf/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
</IfModule>
<IfModule ssl_module>
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
</IfModule>
LoadModule perl_module modules/mod_perl.so


##############
#mod_perl stuff
##############

#turn on Apache::DBI
PerlModule Apache::DBI

#Load our handler
PerlModule Embassy::DispatcherZ

#load our apache AuthCookie subclass 
PerlModule Embassy::Auth

PerlSetVar WhatEverPath /
PerlSetVar secureLoginScript /a/nope

# use to alter how "require" directives are matched. Can be "Any" or "All".
# If its "Any", then you must only match Any of the "require" directives. If
# its "All", then you must match All of the require directives. 
#
# Default: All
PerlSetVar WhatEverSatisfy Any

# The following line is optional - it allows you to set the domain
# scope of your cookie.  Default is the current domain.
PerlSetVar WhatEverDomain .embassysys.com
PerlSetVar WhatEverCookieName heyhey

# Use this to only send over a secure connection
#PerlSetVar WhatEverSecure 0

# Use this if you want user session cookies to expire if the user
# doesn't request a auth-required or recognize_user page for some
# time period.  If set, a new cookie (with updated expire time)
# is set on every request.
#PerlSetVar WhatEverSessionTimeout +30m

# to enable the HttpOnly cookie property, use HttpOnly.
# this is an MS extension.  See:
# http://msdn.microsoft.com/workshop/author/dhtml/httponly_cookies.asp
#PerlSetVar WhatEverHttpOnly 1

# Usually documents are uncached - turn off here
#PerlSetVar WhatEverCache 1

# Use this to make your cookies persistent (+2 hours here)
#PerlSetVar WhatEverExpires +2h

# Use to make AuthCookie send a P3P header with the cookie
# see http://www.w3.org/P3P/ for details about what the value 
# of this should be
#PerlSetVar WhatEverP3P "CP=\"...\""


<Location /z/>
	AuthType Embassy::Auth
	AuthName secure
        SetHandler perl-script
	PerlAuthenHandler Embassy::Auth->authenticate
        PerlAuthzHandler Embassy::Auth->authorize
        PerlHandler Embassy::DispatcherZ
	require valid-user
        #PerlSendHeader On
</Location>

<Location /a/>
	SetHandler perl-script
	PerlHandler Embassy::DispatcherA
</Location>

<LocationMatch  "^/[A-Za-z0-9]+$">
	SetHandler perl-script
	PerlHandler Embassy::DispatcherU
</LocationMatch>


#<Location />
#	AuthType Embassy::Auth
#	AuthName secure
#	PerlAuthenHandler Embassy::Auth->authenticate
#	PerlAuthzHandler Embassy::Auth->authorize
#	require valid-user
#</Location>

# This is the action of the login.pl script above.
<Files !login>
 AuthType Embassy::Auth
 AuthName secure
 SetHandler perl-script
 PerlResponseHandler Embassy::Auth->login
</Files>






